<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="asg4.css">

 <!-- Include socket.io client API from cdn //-->
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

<script>
      /////////////////////// SOCKET_IO STUFF ///////////////
     // USEFUL NOTES???

      // TO-SERVER LOGIN screen-name 
      // server: LOGIN-OK list-of-logged-in-screennames-and-status
      // NEW-GAME screen-name choice-of-X-or-O
      // server: UPDATED-USER-LIST-AND-STATUS list-of-screen-names status
      // JOIN client’s-screen-name opponent’s-screen-name
      // server: UPDATED-USER-LIST-AND-STATUS list-of-screen-names status
      // PLAY X-player-screen-name O-player-screen-name (server to only the 2 players)
      // Send message to Server. 
	// Will create a connection if one is not already established


     
	function sendToServer(messageType, message) {
  		try {
    			if (!connectedSocket) createSocket();
    			connectedSocket.emit(messageType, message); // send msg to server
  		} catch (err) {
    			alert("System error 987: " + err + " contact us, or try again later");
  		}
	}
      var connectedSocket = null;
      function createSocket() {
                  try {
                        connectedSocket = io(window.location.hostname+":8081");
                  } catch (err) {
                        alert('connectedSocket create error, contact us');
                        connectedSocket = null;
                        return;
                  }
            }



      //////////////////////////// DATA BASE STUFF ///////////////////////////
      
      async function addToDB() {
                    const baseUrl = 'http://'+window.location.hostname+':8081/';
                    const input = document.getElementById('Username');
                    if (input.value == '') {return}
                  
                  const res = await fetch(baseUrl,
                  {
                        method:'POST',
                        headers: {
                              "Content-Type": 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({"username": input.value})
                  });

                  console.log(res)
                  //const data = await res.json()
                  const data = await res.text();
                  //input.value = data.info 
                  connectedSocket.emit("TO-SERVER LOGIN screen-name", input.value)
                  alert(data)
            }
      
            /////////////////////Game board actions//////////////////////////
      function toggle_game_div(button) {
            if(document.getElementById('game_window').style.display == 'none') {
                  document.getElementById('game_window').style.display = 'block';
            } else {
                  document.getElementById('game_window').style.display = 'none';    
            }
      }

      let isXTurn = true; 
      let x_num = 2;
      let o_num = 1;
      var move_count  = 0;
       function Take_turn(button){
       const gameSquare = button.parentElement;
          

        // Create a new image element
        const newImage = document.createElement('img');
        newImage.style.maxWidth = '100%';
        newImage.style.maxHeight = '100%'; 
        newImage.style.display = 'block'; 

        if (isXTurn) {
            newImage.src = 'X.png'; 
            newImage.alt = 'X';
            button.parentElement.id = x_num;
        } else {
            newImage.src = 'O.webp'; 
            newImage.alt = 'O';
            button.parentElement.id = o_num;
        }
        console.log(button.parentElement.id)
        button.remove();
        gameSquare.appendChild(newImage);
         x_num += 2;
         o_num += 2;
       
        isXTurn = !isXTurn;

        move_count ++
            
            if (move_count >= 4){
                 Game_status_check()
            }
       }

            var ABC = true
            var DEF = true
            var GHI = true

            var ADG = true
            var BEH = true
            var CFI = true

            var AEI =  true
            var CEG = true 
            
      function Game_status_check(){
            console.log (ABC)
            
            const A = document.getElementsByName('1')[0];
            const B = document.getElementsByName('2')[0];
            const C = document.getElementsByName('3')[0];

            const D = document.getElementsByName('4')[0];
            const E = document.getElementsByName('5')[0];
            const F = document.getElementsByName('6')[0];

            const G = document.getElementsByName('7')[0];
            const H = document.getElementsByName('8')[0];
            const I = document.getElementsByName('9')[0];
            
            var A_val =  (parseInt(A.id) % 2)
            var B_val =  (parseInt(B.id) % 2)
            var C_val =  (parseInt(C.id) % 2)

            var D_val =  (parseInt(D.id) % 2)
            var E_val =  (parseInt(E.id) % 2)
            var F_val =  (parseInt(F.id) % 2)

            var G_val =  (parseInt(G.id) % 2)
            var H_val =  (parseInt(H.id) % 2)
            var I_val =  (parseInt(I.id) % 2)

            const A_defined = !(isNaN(A_val));
            const B_defined = !(isNaN(B_val));
            const C_defined = !(isNaN(C_val));

            const D_defined = !(isNaN(D_val));
            const E_defined = !(isNaN(E_val));
            const F_defined = !(isNaN(F_val));

            const G_defined = !(isNaN(G_val));
            const H_defined = !(isNaN(H_val));
            const I_defined = !(isNaN(I_val));


            if ((A_defined && B_defined) && A_val  != B_val ) ABC = false 
            if ((A_defined && C_defined) && A_val  != C_val ) ABC = false
            if ((B_defined && C_defined) && B_val  != C_val ) ABC = false
            console.log("ABC:")
            console.log(ABC)
            if ((E_defined && D_defined) && E_val  != D_val ) DEF = false 
            if ((E_defined && F_defined) && E_val  != F_val ) DEF = false
            if ((D_defined && F_defined) && D_val  != F_val ) DEF = false
            console.log("DEF:")
            console.log(DEF)
            if ((G_defined && H_defined) && G_val  != H_val ) GHI = false 
            if ((G_defined && I_defined) && G_val  != I_val ) GHI = false
            if ((H_defined && I_defined) && H_val  != I_val ) GHI = false
             console.log("GHI:")
            console.log(GHI)


            //DOWN
            if ((A_defined && D_defined) && A_val  != D_val ) ADG = false 
            if ((A_defined && G_defined) && A_val  != G_val ) ADG = false
            if ((D_defined && G_defined) && D_val  != G_val ) ADG = false
             console.log("ADG:")
            console.log(ADG)
            if ((B_defined && E_defined) && B_val  != E_val ) BEH = false 
            if ((B_defined && H_defined) && B_val  != H_val ) BEH = false
            if ((E_defined && H_defined) && E_val  != H_val ) BEH = false
             console.log("BEH:")
            console.log(BEH)
            if ((C_defined && F_defined) && C_val  != F_val ) CFI = false 
            if ((C_defined && I_defined) && C_val  != I_val ) CFI = false
            if ((F_defined && I_defined) && F_val  != I_val ) CFI = false
            console.log("CFI:")
            console.log(CFI)
            if ((A_defined && E_defined) && A_val  != E_val ) AEI = false 
            if ((A_defined && I_defined) && A_val  != I_val ) AEI = false
            if ((E_defined && I_defined) && E_val  != I_val ) AEI = false
            console.log("AEI:")
            console.log(CEG)  
            if ((C_defined && E_defined) && C_val  != E_val ) CEG = false 
            if ((C_defined && G_defined) && C_val  != G_val ) CEG = false
            if ((E_defined && G_defined) && E_val  != G_val ) CEG = false

/*
            const conditions = [ABC,DEF,GHI,ADG,BEH,CFI,AEI,CEG];

                  let trueCount = 0;
                  for (let i = 0; i < conditions.length; i++) {
                  if (!conditions[i]) {
                        trueCount++;
                        console.log("LICK")
                        console.log(trueCount)
                  }
                  }
                  if (trueCount >= 7){
                        draw()
                  }
*/

      // game logic 
            //across 
            // keep this in its the old draw method 

            // catches error when last move results in a win, 
            if (!ABC && !DEF && !GHI && !ADG && !BEH && !CFI &&!AEI && !CEG ){
                  console.log("ITS A DRAWWW")
            }

            if (ABC){
                  if (( B_val == A_val) && (C_val == A_val  )) {
                        if(A_val  == 0){
                              X_wins();
                        }            
                        else{
                              O_wins()
                        }
                  }
            }
             if(DEF){ 
                  if (( E_val == D_val) && (F_val == D_val )){
                        if(D_val == 0){
                              X_wins()
                        }
                        else{
                              O_wins()
                        }
                  }
            }

             if(GHI){
                  if (( H_val  == G_val  ) && (I_val == G_val )){
                        if(G_val == 0){
                              X_wins()
                        }
                        else{
                              O_wins()
                        }      
                  }      
            } 
            //down
             if(ADG){
                  if (( D_val == A_val ) && (G_val  == A_val  )){

                        if(A_val == 0){
                              
                              X_wins()
                        }
                        else{
                              O_wins()
                        }
                  }
            }
             if (BEH){
                  if (( E_val == B_val ) && (H_val  == B_val )){
                        if(B_val == 0){
                              X_wins()
                        }
                        else{
                              O_wins()
                        } 
                  }
            } 
             if(CFI){
                  if (( F_val  == C_val ) && (I_val == C_val )){
                        if(C_val == 0){
                              X_wins()
                        }
                        else{
                              O_wins()
                        }
                  }
            } 
            // diagonal
             if (AEI){
                  if (( E_val == A_val ) && (I_val == A_val)){
                        if(A_val == 0){
                        X_wins()
                        }
                        else{
                        O_wins()
                        } 
                  }
            }
             if (CEG){

                  if (( E_val  == C_val ) && (G_val  == C_val )){
                        if(C_val == 0){
                        X_wins()
                        }
                        else{
                        O_wins()
                        } 
                  }
            } 
            else{
                  console.log("not a winner")
            } 
      
      }
      function hideResultMenu() {
             document.getElementById("result_menu").style.display = "none";
      }

      function post_game_peek(){

            document.getElementById("result_menu-content").style.display = "none";
            document.getElementById("result_menu").style.backgroundColor = "rgba(0, 0, 0, 0)";

            setTimeout(function() {
            
             document.getElementById("result_menu-content").style.display = "flex"
             document.getElementById("result_menu").style.backgroundColor = "rgba(0, 0, 0, .5)";
            }, 2000); // Delay of 2000 milliseconds (2 seconds)
      }
          function disable_game_table(){
            document.querySelectorAll('.game_squares button').forEach(elem => {
             elem.disabled = true;
            });

            function enable_game_table(){
                  document.querySelectorAll('.game_squares button').forEach(elem => {
             elem.disabled = false;
            });

            }
      }

      function X_wins(){
             
            const rmc = document.getElementById("result_menu-content");
            const result_menu = document.getElementById("result_menu");
            result_menu.style.display = 'flex'; 
            rmc.innerHTML = ''// resets everything so last result screen does not show in new game

            
            const win_msg = document.createElement('h1');
            win_msg.innerHTML = "<img src='X.png' style='height: 100px; vertical-align: middle;" +
                                    "margin-right: 50px;'>" +
                                    "X WINS!!!!" +
                                    "<img src='X.png' style='height: 100px; vertical-align: middle;"+
                                    "margin-left: 50px;'>";
            
            const close_button = document.createElement('button');
            close_button.id = 'Result_close_button';
            close_button.innerHTML = "Close";
            close_button.style.width = "500px"
            close_button.style.height = "75px"
            close_button.onclick = hideResultMenu;
            close_button.style.display = 'flex';
            close_button.style.marginLeft = '25px'

            const view_game_table = document.createElement('button');
            view_game_table.id = 'Result_close_button';

            view_game_table.onclick = post_game_peek
            
            view_game_table.innerHTML = "View game board ";

            rmc.appendChild(win_msg);
            win_msg.appendChild(close_button);
            win_msg.appendChild(view_game_table)
            disable_game_table()
      }

      function O_wins(){
            const rmc = document.getElementById("result_menu-content");
            const result_menu = document.getElementById("result_menu");
            result_menu.style.display = 'flex'; 
            rmc.innerHTML = '' // resets everything so last result screen does not show in new game

            const win_msg = document.createElement('h1');
            win_msg.innerHTML = "<img src='O.webp' style='height: 100px; vertical-align: middle;" +
                                    "margin-right: 50px;'>" +
                                    "O WINS!!!!" +
                                    "<img src='O.webp' style='height: 100px; vertical-align: middle;"+
                                    "margin-left: 50px;'>";
            
            const close_button = document.createElement('button');
            close_button.id = 'Result_close_button';
            close_button.innerHTML = "Close";
            close_button.style.width = "500px"
            close_button.style.height = "75px"
            close_button.onclick = hideResultMenu;
            close_button.style.display = 'flex';
            close_button.style.marginLeft = '25px'

            const view_game_table = document.createElement('button');
            view_game_table.id = 'Result_close_button';

            view_game_table.onclick = post_game_peek
            
            view_game_table.innerHTML = "View game board ";

            rmc.appendChild(win_msg);
            win_msg.appendChild(close_button);
            win_msg.appendChild(view_game_table)

            disable_game_table()
      }
      function draw(){
            const rmc = document.getElementById("result_menu-content");
            const result_menu = document.getElementById("result_menu");
            result_menu.style.display = 'flex'; 
            rmc.innerHTML = ''// resets everything so last result screen does not show in new game

            
            const win_msg = document.createElement('h1');
            win_msg.innerHTML = "<img src='X.png' style='height: 100px; vertical-align: middle;" +
                                    "margin-right: 50px;'>" +
                                    "It's a draw!!!" +
                                    "<img src='O.webp' style='height: 100px; vertical-align: middle;"+
                                    "margin-left: 50px;'>";
            
            const close_button = document.createElement('button');
            close_button.id = 'Result_close_button';
            close_button.innerHTML = "Close";
            close_button.style.width = "500px"
            close_button.style.height = "75px"
            close_button.onclick = hideResultMenu;
            close_button.style.display = 'flex';
            close_button.style.marginLeft = '25px'

            const view_game_table = document.createElement('button');
            view_game_table.id = 'Result_close_button';

            view_game_table.onclick = post_game_peek
            
            view_game_table.innerHTML = "View game board ";

            rmc.appendChild(win_msg);
            win_msg.appendChild(close_button);
            win_msg.appendChild(view_game_table)
            disable_game_table()

      }

      // runs connection as soon as script loads
      createSocket();
</script>
</head>
<body>
      <table id="headtable" style="width: 100%;"> <!--creates head table -->
      <tr>
            <!--creates welcome banner and shows it to user-->
            <th colspan="3" style="font-size: 200%;"> <img src="X.png" alt="X" style="height: 40px; float: left;"> THE BEST TIC-TAC-TOE WEBSITE <img src="O.webp" alt="P" style="height: 40px; float: right;" ></th>
      </tr>
      <tr>
            <th colspan="3" style="font-size: 150%; text-align: right; cursor: pointer;" onclick = >
                  <a id= help_box  href="#"  onclick="alert('help'); return false;">Help |</a>
                  <a id="help_box" href="#" onclick="alert('logout')"; return false;>Logout</a> 
            </th>
      </tr>

      </table>
      
      <div id = "main_box">
            <center>
            <div id = "idle">
                  idle users:
            </div>
            <div id = "avialable_games">
                  Active games
                  <table id = "actives" style = "border: 2px solid black; border-collapse: collapse; text-align: center; width: 100%;">
                        <tr>
                              <th>
                                    test
                              </th>
                              <th>
                                    test
                              </th>
                        </tr>
                  </table>
                  <button onclick = "toggle_game_div()"><h1>JOIN</h1></button>
            </div>
           
            
            <div id = "game_window" style="">
            <div id = "game_info"> 
                  <div class = "game_info_categories"> <h1 style="text-align: center">X: USERNAME</h1></div>
                  <div class = "game_info_categories"> <h1 style="text-align: center">X's TURN</h1></div>
                  <div class = "game_info_categories"> <h1 style="text-align: center">O: USERNAME</h1></div>
            </div>
            <div id = "game_contain_squares"> 
                  <div class = "game_squares" name = "1"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "2"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "3"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "4"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "5"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "6"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "7"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "8"><button class="board_button" onclick="Take_turn(this)"></button></div>
                  <div class = "game_squares" name = "9"><button class="board_button" onclick="Take_turn(this)"></button></div>
            </div>
            <div width="100%" style= "">
                  <h1 onclick="toggle_game_div()" style="cursor: pointer;">LEAVE</h1>
            </div>
            </center>
      </div>
      </div>
      <div>
            
      </div>

      <div id = "Open_menu" style="display:none"> <!-- remove 'none'-->
            <div class="Open_menu-content">
                  <h1 style="text-align: center;">Welcome to the best tic-tac-toe website out There</h1>
                  <h3>Created by Ryan and Bear:</h3>
                  <p> Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat.
                        In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar
                        vivamus fringilla lacus nec metus bibendum egestas. 
                        Iaculis massa nisl malesuada lacinia integer nunc posuere.
                        Ut hendrerit semper vel class aptent taciti sociosqu. 
                        Ad litora torquent per conubia nostra inceptos himenaeos. </p>
                  <p>Lorem ipsum dolor sit amet consectetur adipiscing elit.
                        Quisque faucibus ex sapien vitae pellentesque sem placerat. 
                        In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor.
                        Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. 
                        Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos</p>
                  <p>Lorem ipsum dolor sit amet consectetur adipiscing elit. 
                        Quisque faucibus ex sapien vitae pellentesque sem placerat. 
                        In id cursus mi pretium tellus duis convallis. 
                        Tempus leo eu aenean sed diam urna tempor. 
                        Pulvinar vivamus fringilla lacus nec metus bibendum egestas. 
                        Iaculis massa nisl malesuada lacinia integer nunc posuere. 
                        Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per 
                        conubia nostra inceptos himenaeos.Lorem ipsum dolor sit amet consectetur 
                        adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat.
                  </p>
                        

                  <p>ARE YOU READY?</p>

                  <div>
                  <form onsubmit="document.getElementById('Open_menu').style.display = 'none'; return false;"> <!-- doesnt reload the page and hides the menu -->
                  <label for="Username">Username:</label><br>
                  <input type="text" id="Username"  placeholder="John"><br>

                  <div id= "name_taken" class="err_msg hidden">That Username is already taken. Please try a new name</div>
                  <div id = "empty name" class=" err_msg hidden"> name cannot be null</div>

                  <input type="submit" value="Submit" onclick="addToDB()">
                  </form> 
                  </div>
            </div>
      </div>
      <div id="result_menu" style="display: none ">
            <div id="result_menu-content">
                
      </div>
</body>
</html>


<!-- MENY NOTES TO NOTE 
 #1 We have a function to give ckiclys back to buttons. we just dont have a spot to call it yet 
 since we need to reset game board after each join and whatnot -->